import{ACTION_ALL,ACTION_CROP,ACTION_EAST,ACTION_MOVE,ACTION_NORTH,ACTION_NORTH_EAST,ACTION_NORTH_WEST,ACTION_SOUTH,ACTION_SOUTH_EAST,ACTION_SOUTH_WEST,ACTION_WEST,ACTION_ZOOM,CLASS_HIDDEN}from"./constants";import{forEach,getMaxZoomRatio,getOffset,removeClass}from"./utilities";export default{change(T){const{options:O,canvasData:e,containerData:t,cropBoxData:_,pointers:A}=this;let{action:N}=this,{aspectRatio:i}=O,{left:C,top:a,width:I,height:S}=_;const s=C+I,r=a+S;let h,E=0,o=0,y=t.width,x=t.height,H=!0;!i&&T.shiftKey&&(i=I&&S?I/S:1),this.limited&&(({minLeft:E,minTop:o}=_),y=E+Math.min(t.width,e.width,e.left+e.width),x=o+Math.min(t.height,e.height,e.top+e.height));const c=A[Object.keys(A)[0]],f={x:c.endX-c.startX,y:c.endY-c.startY},R=T=>{switch(T){case ACTION_EAST:s+f.x>y&&(f.x=y-s);break;case ACTION_WEST:C+f.x<E&&(f.x=E-C);break;case ACTION_NORTH:a+f.y<o&&(f.y=o-a);break;case ACTION_SOUTH:r+f.y>x&&(f.y=x-r)}};switch(N){case ACTION_ALL:C+=f.x,a+=f.y;break;case ACTION_EAST:if(f.x>=0&&(s>=y||i&&(a<=o||r>=x))){H=!1;break}R(ACTION_EAST),(I+=f.x)<0&&(N=ACTION_WEST,C-=I=-I),i&&(S=I/i,a+=(_.height-S)/2);break;case ACTION_NORTH:if(f.y<=0&&(a<=o||i&&(C<=E||s>=y))){H=!1;break}R(ACTION_NORTH),S-=f.y,a+=f.y,S<0&&(N=ACTION_SOUTH,a-=S=-S),i&&(I=S*i,C+=(_.width-I)/2);break;case ACTION_WEST:if(f.x<=0&&(C<=E||i&&(a<=o||r>=x))){H=!1;break}R(ACTION_WEST),I-=f.x,C+=f.x,I<0&&(N=ACTION_EAST,C-=I=-I),i&&(S=I/i,a+=(_.height-S)/2);break;case ACTION_SOUTH:if(f.y>=0&&(r>=x||i&&(C<=E||s>=y))){H=!1;break}R(ACTION_SOUTH),(S+=f.y)<0&&(N=ACTION_NORTH,a-=S=-S),i&&(I=S*i,C+=(_.width-I)/2);break;case ACTION_NORTH_EAST:if(i){if(f.y<=0&&(a<=o||s>=y)){H=!1;break}R(ACTION_NORTH),S-=f.y,a+=f.y,I=S*i}else R(ACTION_NORTH),R(ACTION_EAST),f.x>=0?s<y?I+=f.x:f.y<=0&&a<=o&&(H=!1):I+=f.x,f.y<=0?a>o&&(S-=f.y,a+=f.y):(S-=f.y,a+=f.y);I<0&&S<0?(N=ACTION_SOUTH_WEST,a-=S=-S,C-=I=-I):I<0?(N=ACTION_NORTH_WEST,C-=I=-I):S<0&&(N=ACTION_SOUTH_EAST,a-=S=-S);break;case ACTION_NORTH_WEST:if(i){if(f.y<=0&&(a<=o||C<=E)){H=!1;break}R(ACTION_NORTH),S-=f.y,a+=f.y,I=S*i,C+=_.width-I}else R(ACTION_NORTH),R(ACTION_WEST),f.x<=0?C>E?(I-=f.x,C+=f.x):f.y<=0&&a<=o&&(H=!1):(I-=f.x,C+=f.x),f.y<=0?a>o&&(S-=f.y,a+=f.y):(S-=f.y,a+=f.y);I<0&&S<0?(N=ACTION_SOUTH_EAST,a-=S=-S,C-=I=-I):I<0?(N=ACTION_NORTH_EAST,C-=I=-I):S<0&&(N=ACTION_SOUTH_WEST,a-=S=-S);break;case ACTION_SOUTH_WEST:if(i){if(f.x<=0&&(C<=E||r>=x)){H=!1;break}R(ACTION_WEST),I-=f.x,C+=f.x,S=I/i}else R(ACTION_SOUTH),R(ACTION_WEST),f.x<=0?C>E?(I-=f.x,C+=f.x):f.y>=0&&r>=x&&(H=!1):(I-=f.x,C+=f.x),f.y>=0?r<x&&(S+=f.y):S+=f.y;I<0&&S<0?(N=ACTION_NORTH_EAST,a-=S=-S,C-=I=-I):I<0?(N=ACTION_SOUTH_EAST,C-=I=-I):S<0&&(N=ACTION_NORTH_WEST,a-=S=-S);break;case ACTION_SOUTH_EAST:if(i){if(f.x>=0&&(s>=y||r>=x)){H=!1;break}R(ACTION_EAST),S=(I+=f.x)/i}else R(ACTION_SOUTH),R(ACTION_EAST),f.x>=0?s<y?I+=f.x:f.y>=0&&r>=x&&(H=!1):I+=f.x,f.y>=0?r<x&&(S+=f.y):S+=f.y;I<0&&S<0?(N=ACTION_NORTH_WEST,a-=S=-S,C-=I=-I):I<0?(N=ACTION_SOUTH_WEST,C-=I=-I):S<0&&(N=ACTION_NORTH_EAST,a-=S=-S);break;case ACTION_MOVE:this.move(f.x,f.y),H=!1;break;case ACTION_ZOOM:this.zoom(getMaxZoomRatio(A),T),H=!1;break;case ACTION_CROP:if(!f.x||!f.y){H=!1;break}h=getOffset(this.cropper),C=c.startX-h.left,a=c.startY-h.top,I=_.minWidth,S=_.minHeight,f.x>0?N=f.y>0?ACTION_SOUTH_EAST:ACTION_NORTH_EAST:f.x<0&&(C-=I,N=f.y>0?ACTION_SOUTH_WEST:ACTION_NORTH_WEST),f.y<0&&(a-=S),this.cropped||(removeClass(this.cropBox,CLASS_HIDDEN),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}H&&(_.width=I,_.height=S,_.left=C,_.top=a,this.action=N,this.renderCropBox()),forEach(A,T=>{T.startX=T.endX,T.startY=T.endY})}};