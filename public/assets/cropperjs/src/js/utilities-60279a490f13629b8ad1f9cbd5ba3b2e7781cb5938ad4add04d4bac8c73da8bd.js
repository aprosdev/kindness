import{IS_BROWSER,WINDOW}from"./constants";export const isNaN=Number.isNaN||WINDOW.isNaN;export function isNumber(t){return"number"==typeof t&&!isNaN(t)};export const isPositiveNumber=t=>t>0&&t<Infinity;export function isUndefined(t){return void 0===t};export function isObject(t){return"object"==typeof t&&null!==t};const{hasOwnProperty:hasOwnProperty}=Object.prototype;export function isPlainObject(t){if(!isObject(t))return!1;try{const{constructor:n}=t,{prototype:r}=n;return n&&r&&hasOwnProperty.call(r,"isPrototypeOf")}catch(e){return!1}};export function isFunction(t){return"function"==typeof t};const{slice:slice}=Array.prototype;export function toArray(t){return Array.from?Array.from(t):slice.call(t)};export function forEach(t,e){return t&&isFunction(e)&&(Array.isArray(t)||isNumber(t.length)?toArray(t).forEach((n,r)=>{e.call(t,n,r,t)}):isObject(t)&&Object.keys(t).forEach(n=>{e.call(t,t[n],n,t)})),t};export const assign=Object.assign||function(t,...e){return isObject(t)&&e.length>0&&e.forEach(e=>{isObject(e)&&Object.keys(e).forEach(n=>{t[n]=e[n]})}),t};const REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/;export function normalizeDecimalNumber(t,e=1e11){return REGEXP_DECIMALS.test(t)?Math.round(t*e)/e:t};const REGEXP_SUFFIX=/^width|height|left|top|marginLeft|marginTop$/;export function setStyle(t,e){const{style:n}=t;forEach(e,(t,e)=>{REGEXP_SUFFIX.test(e)&&isNumber(t)&&(t=`${t}px`),n[e]=t})};export function hasClass(t,e){return t.classList?t.classList.contains(e):t.className.indexOf(e)>-1};export function addClass(t,e){if(!e)return;if(isNumber(t.length))return void forEach(t,t=>{addClass(t,e)});if(t.classList)return void t.classList.add(e);const n=t.className.trim();n?n.indexOf(e)<0&&(t.className=`${n} ${e}`):t.className=e};export function removeClass(t,e){e&&(isNumber(t.length)?forEach(t,t=>{removeClass(t,e)}):t.classList?t.classList.remove(e):t.className.indexOf(e)>=0&&(t.className=t.className.replace(e,"")))};export function toggleClass(t,e,n){e&&(isNumber(t.length)?forEach(t,t=>{toggleClass(t,e,n)}):n?addClass(t,e):removeClass(t,e))};const REGEXP_CAMEL_CASE=/([a-z\d])([A-Z])/g;export function toParamCase(t){return t.replace(REGEXP_CAMEL_CASE,"$1-$2").toLowerCase()};export function getData(t,e){return isObject(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute(`data-${toParamCase(e)}`)};export function setData(t,e,n){isObject(n)?t[e]=n:t.dataset?t.dataset[e]=n:t.setAttribute(`data-${toParamCase(e)}`,n)};export function removeData(t,e){if(isObject(t[e]))try{delete t[e]}catch(n){t[e]=undefined}else if(t.dataset)try{delete t.dataset[e]}catch(n){t.dataset[e]=undefined}else t.removeAttribute(`data-${toParamCase(e)}`)};const REGEXP_SPACES=/\s\s*/,onceSupported=(()=>{let t=!1;if(IS_BROWSER){let e=!1;const n=()=>{},r=Object.defineProperty({},"once",{get:()=>(t=!0,e),set(t){e=t}});WINDOW.addEventListener("test",n,r),WINDOW.removeEventListener("test",n,r)}return t})();export function removeListener(t,e,n,r={}){let a=n;e.trim().split(REGEXP_SPACES).forEach(e=>{if(!onceSupported){const{listeners:r}=t;r&&r[e]&&r[e][n]&&(a=r[e][n],delete r[e][n],0===Object.keys(r[e]).length&&delete r[e],0===Object.keys(r).length&&delete t.listeners)}t.removeEventListener(e,a,r)})};export function addListener(t,e,n,r={}){let a=n;e.trim().split(REGEXP_SPACES).forEach(e=>{if(r.once&&!onceSupported){const{listeners:o={}}=t;a=((...s)=>{delete o[e][n],t.removeEventListener(e,a,r),n.apply(t,s)}),o[e]||(o[e]={}),o[e][n]&&t.removeEventListener(e,o[e][n],r),o[e][n]=a,t.listeners=o}t.addEventListener(e,a,r)})};export function dispatchEvent(t,e,n){let r;return isFunction(Event)&&isFunction(CustomEvent)?r=new CustomEvent(e,{detail:n,bubbles:!0,cancelable:!0}):(r=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,n),t.dispatchEvent(r)};export function getOffset(t){const e=t.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}};const{location:location}=WINDOW,REGEXP_ORIGINS=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;export function isCrossOriginURL(t){const e=t.match(REGEXP_ORIGINS);return null!==e&&(e[1]!==location.protocol||e[2]!==location.hostname||e[3]!==location.port)};export function addTimestamp(t){const e=`timestamp=${(new Date).getTime()}`;return t+(-1===t.indexOf("?")?"?":"&")+e};export function getTransforms({rotate:t,scaleX:e,scaleY:n,translateX:r,translateY:a}){const o=[];isNumber(r)&&0!==r&&o.push(`translateX(${r}px)`),isNumber(a)&&0!==a&&o.push(`translateY(${a}px)`),isNumber(t)&&0!==t&&o.push(`rotate(${t}deg)`),isNumber(e)&&1!==e&&o.push(`scaleX(${e})`),isNumber(n)&&1!==n&&o.push(`scaleY(${n})`);const s=o.length?o.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}};export function getMaxZoomRatio(t){const e=assign({},t),n=[];return forEach(t,(t,r)=>{delete e[r],forEach(e,e=>{const r=Math.abs(t.startX-e.startX),a=Math.abs(t.startY-e.startY),o=Math.abs(t.endX-e.endX),s=Math.abs(t.endY-e.endY),i=Math.sqrt(r*r+a*a),c=(Math.sqrt(o*o+s*s)-i)/i;n.push(c)})}),n.sort((t,e)=>Math.abs(t)<Math.abs(e)),n[0]};export function getPointer({pageX:t,pageY:e},n){const r={endX:t,endY:e};return n?r:assign({startX:t,startY:e},r)};export function getPointersCenter(t){let e=0,n=0,r=0;return forEach(t,({startX:t,startY:a})=>{e+=t,n+=a,r+=1}),{pageX:e/=r,pageY:n/=r}};export function getAdjustedSizes({aspectRatio:t,height:e,width:n},r="contain"){const a=isPositiveNumber(n),o=isPositiveNumber(e);if(a&&o){const a=e*t;"contain"===r&&a>n||"cover"===r&&a<n?e=n/t:n=e*t}else a?e=n/t:o&&(n=e*t);return{width:n,height:e}};export function getRotatedSizes({width:t,height:e,degree:n}){if(90===(n=Math.abs(n)%180))return{width:e,height:t};const r=n%90*Math.PI/180,a=Math.sin(r),o=Math.cos(r),s=t*o+e*a,i=t*a+e*o;return n>90?{width:i,height:s}:{width:s,height:i}};export function getSourceCanvas(t,{aspectRatio:e,naturalWidth:n,naturalHeight:r,rotate:a=0,scaleX:o=1,scaleY:s=1},{aspectRatio:i,naturalWidth:c,naturalHeight:l},{fillColor:u="transparent",imageSmoothingEnabled:h=!0,imageSmoothingQuality:f="low",maxWidth:d=Infinity,maxHeight:m=Infinity,minWidth:p=0,minHeight:g=0}){const E=document.createElement("canvas"),b=E.getContext("2d"),x=getAdjustedSizes({aspectRatio:i,width:d,height:m}),C=getAdjustedSizes({aspectRatio:i,width:p,height:g},"cover"),y=Math.min(x.width,Math.max(C.width,c)),N=Math.min(x.height,Math.max(C.height,l)),O=getAdjustedSizes({aspectRatio:e,width:d,height:m}),A=getAdjustedSizes({aspectRatio:e,width:p,height:g},"cover"),v=Math.min(O.width,Math.max(A.width,n)),S=Math.min(O.height,Math.max(A.height,r)),w=[-v/2,-S/2,v,S];return E.width=normalizeDecimalNumber(y),E.height=normalizeDecimalNumber(N),b.fillStyle=u,b.fillRect(0,0,y,N),b.save(),b.translate(y/2,N/2),b.rotate(a*Math.PI/180),b.scale(o,s),b.imageSmoothingEnabled=h,b.imageSmoothingQuality=f,b.drawImage(t,...w.map(t=>Math.floor(normalizeDecimalNumber(t)))),b.restore(),E};const{fromCharCode:fromCharCode}=String;export function getStringFromCharCode(t,e,n){let r="";n+=e;for(let a=e;a<n;a+=1)r+=fromCharCode(t.getUint8(a));return r};const REGEXP_DATA_URL_HEAD=/^data:.*,/;export function dataURLToArrayBuffer(t){const e=t.replace(REGEXP_DATA_URL_HEAD,""),n=atob(e),r=new ArrayBuffer(n.length),a=new Uint8Array(r);return forEach(a,(t,e)=>{a[e]=n.charCodeAt(e)}),r};export function arrayBufferToDataURL(t,e){const n=[],r=8192;let a=new Uint8Array(t);for(;a.length>0;)n.push(fromCharCode.apply(null,toArray(a.subarray(0,r)))),a=a.subarray(r);return`data:${e};base64,${btoa(n.join(""))}`};export function resetAndGetOrientation(t){const e=new DataView(t);let n;try{let t,a,o;if(255===e.getUint8(0)&&216===e.getUint8(1)){const t=e.byteLength;let n=2;for(;n+1<t;){if(255===e.getUint8(n)&&225===e.getUint8(n+1)){a=n;break}n+=1}}if(a){const n=a+10;if("Exif"===getStringFromCharCode(e,a+4,4)){const r=e.getUint16(n);if(((t=18761===r)||19789===r)&&42===e.getUint16(n+2,t)){const r=e.getUint32(n+4,t);r>=8&&(o=n+r)}}}if(o){const r=e.getUint16(o,t);let a,s;for(s=0;s<r;s+=1)if(a=o+12*s+2,274===e.getUint16(a,t)){a+=8,n=e.getUint16(a,t),e.setUint16(a,1,t);break}}}catch(r){n=1}return n};export function parseOrientation(t){let e=0,n=1,r=1;switch(t){case 2:n=-1;break;case 3:e=-180;break;case 4:r=-1;break;case 5:e=90,r=-1;break;case 6:e=90;break;case 7:e=90,n=-1;break;case 8:e=-90}return{rotate:e,scaleX:n,scaleY:r}};